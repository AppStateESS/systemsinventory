<script type="text/javascript">
var runOnLoad = function()
{
    $('.pager-row').click(function() {
        $("#edit-device-button").css("display","block");
        $("#edit-device-button1").css("display","block");
        $("#save-device-button").css("display","none");
        $("#device-save-result").css("display", "none");
        $.getJSON('systemsinventory/system/getDetails/',{
            'device_id': $(this).data('rowId')}, function(jsondata) {
            // display data
            var device_type_id = jsondata['device_type_id'];
            $("#system-body").load("./mod/systemsinventory/templates/Edit_PC.html");
            $("#user-body").load("./mod/systemsinventory/templates/Edit_User.html", function(){
                loadSystemDetails(jsondata,device_type_id);
            });
            $("#device-modal").modal('show');

        });
    });
    
    function loadSystemDetails(jsondata,device_type_id){
        $.each(jsondata, function(index, d){
            var element_id = index.replace("_","-");
            if(index == "departments"){
                $("#department").append(d);
                $("#department").val(jsondata['department_id']);
            }
            if(index == "locations"){
                $("#location").append(d);
                $("#location").val(jsondata['location_id']);
            }
            if(index == "system_usage"){
                $("#system-usage").val(jsondata['system_usage']);
            }
        $("#"+element_id).val(d);
        });
        if(device_type_id == 2)
            $("#server").prop("checked",true);
        // Need to move this section to pc/server specific function
        $("#battery-backup").prop("checked",jsondata['battery_backup']);
        $("#redundant-backup").prop("checked",jsondata['redundant_backup']);
        $("#touch-screen").prop("checked",jsondata['touch_screen']);
        $("#dual-monitor").prop("checked",jsondata['dual_monitor']);
        $("#rotation").prop("checked",jsondata['rotation']);
        $("#stand").prop("checked",jsondata['stand']);
        $("#smart-screen").prop("checked",jsondata['smart_screen']);
        $("#check-in").prop("checked",jsondata['check_in']);

    }
};

$(document).ready(function () {
    $('.pager-column').css('cursor', 'pointer');
    Pagers.callback = runOnLoad;
});

 function enableFormFields(){
       var pc_attributes = ["physical-id","model","processor","ram","hd","video-card","os","vlan","server","battery-backup","redundant-backup","rotation","smart-room","mac","mac2","primary-ip","secondary-ip","primary-monitor","secondary-monitor","purchase-date","server-type","touch-screen","stand","dual-monitor","check-in"];
       var user_attributes = ["system-usage","username","first-name","last-name","department","location","room-number","phone"];
       $.each(pc_attributes, function(index, d){
        $("#"+d).prop("disabled", false);
    });
    
    $.each(user_attributes, function(index, d){
        $("#"+d).prop("disabled", false);
    });
    
    $("#edit-device-button").css("display","none");
    $("#edit-device-button1").css("display","none");
    $("#save-device-button").css("display","block");
    }
    
</script>

<div class="pager-listing" id="device-list" data-rpp="25">
    <div style="text-align:right" class="pager-search"></div>
   
    <table class="table table-striped">
        <thead class="pager-head">
            <tr>
                <th class="pager-header physical_id"></th>
                <th class="pager-header department_id"></th>
                <th class="pager-header location_id"></th>
                <th class="pager-header model"></th>
                <th class="pager-header room_number"></th>
                <th class="pager-header username"></th>
                <th class="pager-header purchase_date"></th>
            </tr>
        </thead>
        <tbody class="pager-body">
            <tr class="pager-row" data-row-id="">
                <td class="pager-column physical_id"></td>
                <td class="pager-column department_id"></td>
                <td class="pager-column location_id"></td>
                <td class="pager-column model"></td>
                <td class="pager-column room_number"></td>
                <td class="pager-column username"></td>
                <td class="pager-column purchase_date"></td>
            </tr> 
            
        </tbody>
    </table>
    <div class="page-list pagination pagination-centered"></div>
    <div class="page-limit"></div>
</div>
<div id="device-modal" class="modal fade" role="dialog" style="display:none;">
    <div class="modal-dialog">
        <div class="modal-content" id="system-device-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">System Details</h4>              
                <input id="edit-device-button" class="btn btn-primary" onclick="enableFormFields()" type="button" value="Edit"/>
                <div id="device-save-result" class="alert alert-success" style="display:none;"></div>
            </div>
            <div class="modal-body">
                <form action="/" method="post" id="edit-device-form" class="phpws-form">
                <div id="system-body"></div>
                <div id="user-body"></div>
                <input id="edit-device-button1" class="btn btn-primary" onclick="enableFormFields()" type="button" value="Edit" />
                <input id="save-device-button" style="display:none;" class="btn btn-primary" type="submit" value="Save" />
                </form>
            </div>
            <div class="modal-footer">
<!--                 <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>-->
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
 $('#edit-device-form').submit( function(event) {
     event.preventDefault();
     var posting = $.post('systemsinventory/system/save/', $('form#edit-device-form').serialize(), null ,'json');
     //var jsondata = posting["responseText"];
     //$( "#device-save-result" ).empty().append( posting['success'] );
     posting.done(function( data ) {
         //var content = $( data ).find( "#content" );
         var result = jQuery.parseJSON(posting['responseText']);
         if(result.success)
             $( "#device-save-result" ).empty().append( "Device Saved Successfully" );
         else
             $( "#device-save-result" ).empty().append( "There was a problem saving device!" );

         $("#device-save-result").css("display", "block");
         $('#device-modal').animate({scrollTop:0}, 'fast');
     });
     
    });   
</script>